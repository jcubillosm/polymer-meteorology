<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../components/meteorology-card.html">

<dom-module id="meteorology-app">
  <template>
    <style>
      :host {
        display: block;
      }
      paper-card {
        height: 50vh;
        width: 45vw;
      }
      paper-header-panel {
        height: 10vh;
        text-align:center;
      }
    </style>
    <iron-ajax id="ajax" auto
               url="http://api.openweathermap.org/data/2.5/forecast/city"
               params='{"id": "3117732", "APPID": "0f9dc1c29165b161dfbef48c75a2f010"}'
               handleAs="json"
               on-response="_weatherResponse">
    </iron-ajax>
    <paper-header-panel class="flex">
      <paper-toolbar>
        <div>Meteorology!</div>
      </paper-toolbar>
    </paper-header-panel>

    <template is="dom-if" if=[[data]]>
      <template is="dom-repeat" items=[[objAsArray]]>
        <meteorology-card weather=[[items]]></meteorology-card>
      </template>
    </template>
  </template>
  <script>
    Polymer({

      is: 'meteorology-app',

      properties: {
        objAsArray: {
          type: Array,
          value: []
        },
        data: {
          type: Object,
          value: {}
        },
        icon: {
          type: Object,
          value: {
            "01d": "wi-day-sunny",
            "01n": "wi-night-clear",
            "02d": "wi-day-cloudy",
            "02n": "wi-night-cloudy",
            "03d": "wi-cloudy",
            "03n": "wi-cloudy",
            "04d": "wi-cloudy",
            "04n": "wi-cloudy",
            "09d": "wi-showers",
            "09n": "wi-showers",
            "10d": "wi-day-rain",
            "10n": "wi-night-rain",
            "11d": "wi-thunderstorm",
            "11n": "wi-thunderstorm",
            "13d": "wi-snow",
            "13n": "wi-snow",
            "50d": "wi-fog",
            "50n": "wi-fog"
          } 
        }
      },
      
      _weatherResponse: function (e) {
        var values = e.detail.response;
        var that = this;
        values.list.forEach (function (element, index, array) {
          that.data [index] = {
            iconData: that.icon[element.weather[0].icon],
            description: element.weather[0].description
            // name: res.name,
            // sunrise: dateHelper(sunrise.getHours()) + ":" + dateHelper(sunrise.getMinutes()),
            // sunset: dateHelper(sunset.getHours()) + ":" + dateHelper(sunset.getMinutes()),
            // currentTemp: Math.round(res.main.temp),
            // minTemp: Math.round(res.main.temp_min),
            // maxTemp: Math.round(res.main.temp_max),
            // windSpeed: res.wind.speed,
            // windDirection: this.windDirections[Math.round(res.wind.deg / 45) % 8],
            // cloudiness: res.clouds.all,
            // humidity: res.main.humidity,
            // pressure: res.main.pressure,
            // tempLevel: getTempLevel(res.main.temp, this.imperial)
          };
        });
        this._toArray();
      },
       _toArray: function () {
            var propArray = [];
            for (var prop in this.data) {
                if (this.data.hasOwnProperty(prop)) {
                    propArray.push({name: prop, value: this.data[prop]});
                }
            }

            this.objAsArray = propArray;
            console.log(this.objAsArray[0].value.description);
        }

    });
  </script>
</dom-module>
